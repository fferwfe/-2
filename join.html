<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>åŠ å…¥éŠæˆ²</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:"Microsoft JhengHei",system-ui;margin:30px}
    input{width:100%;padding:12px;font-size:18px;margin:8px 0}
    button{padding:12px;border-radius:10px;border:0;font-size:18px;font-weight:900;background:#2b6dff;color:#fff}
    .err{color:red;font-weight:900}
  </style>
</head>
<body>

<h1>åŠ å…¥éŠæˆ²</h1>

<input id="pin" placeholder="è¼¸å…¥ PIN">
<input id="name" placeholder="è‡ªç”±å‘½åï¼ˆä¾‹ï¼šç¬¬ä¸€çµ„ã€ç´…éšŠï¼‰">

<button id="btnJoin">åŠ å…¥</button>
<div class="err" id="err"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import {
  getFirestore, doc, getDoc, setDoc,
  serverTimestamp, onSnapshot
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

/* ğŸ”§ æ›æˆä½ è‡ªå·±çš„ firebaseConfigï¼ˆä¸‰å€‹æª”æ¡ˆè¦ä¸€æ¨£ï¼‰ */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const pinEl = document.getElementById("pin");
const nameEl = document.getElementById("name");
const errEl = document.getElementById("err");

document.getElementById("btnJoin").onclick = async ()=>{
  errEl.textContent="";
  const pin = pinEl.value.trim();
  const name = nameEl.value.trim();

  if(!pin || !name){
    errEl.textContent="è«‹è¼¸å…¥ PIN èˆ‡åç¨±";
    return;
  }

  const roomRef = doc(db,"rooms",pin);
  const snap = await getDoc(roomRef);
  if(!snap.exists()){
    errEl.textContent="æ‰¾ä¸åˆ°æˆ¿é–“";
    return;
  }

  const playerId = crypto.randomUUID();
  await setDoc(doc(db,"rooms",pin,"players",playerId),{
    name,
    joinedAt:serverTimestamp()
  });

  // ç­‰å¾…ä¸»æŒäººé–‹å§‹
  onSnapshot(roomRef, s=>{
    if(s.data().status==="playing"){
      location.href=`game.html?pin=${pin}&player=${playerId}`;
    }
  });
};
</script>
</body>
</html>
