<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>ä¸»æŒäººé–‹æˆ¿</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:"Microsoft JhengHei",system-ui;margin:30px}
    .pin{font-size:56px;font-weight:900;letter-spacing:6px}
    button{padding:12px 18px;border-radius:10px;border:0;font-size:18px;font-weight:900}
    .primary{background:#2b6dff;color:#fff}
    .muted{opacity:.7}
    ul{margin-top:10px}
  </style>
</head>
<body>

<h1>ä¸»æŒäººå¾Œå°</h1>

<div class="muted">è«‹ç©å®¶ç”¨æ‰‹æ©Ÿé–‹ï¼š</div>
<div class="muted"><b>https://fferwfe.github.io/-2/join.html</b></div>

<h2>æˆ¿é–“ PIN</h2>
<div class="pin" id="pin">------</div>

<button class="primary" id="btnStart" disabled>é–‹å§‹éŠæˆ²</button>

<h3>å·²åŠ å…¥ç©å®¶</h3>
<ul id="playerList"></ul>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import {
  getFirestore, doc, setDoc, getDoc,
  collection, onSnapshot, serverTimestamp, updateDoc
} from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

/* ğŸ”§ æ›æˆä½ è‡ªå·±çš„ firebaseConfigï¼ˆä¸‰å€‹æª”æ¡ˆè¦ä¸€æ¨£ï¼‰ */
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const elPin = document.getElementById("pin");
const elList = document.getElementById("playerList");
const btnStart = document.getElementById("btnStart");

function genPin(){
  return String(Math.floor(100000 + Math.random()*900000));
}

const pin = genPin();
elPin.textContent = pin;

const roomRef = doc(db,"rooms",pin);

// å»ºç«‹æˆ¿é–“
await setDoc(roomRef,{
  status:"lobby",
  createdAt:serverTimestamp(),
  hostSecret:crypto.randomUUID()
});

// ç›£è½ç©å®¶åŠ å…¥
onSnapshot(collection(db,"rooms",pin,"players"), snap=>{
  elList.innerHTML="";
  snap.forEach(d=>{
    const li=document.createElement("li");
    li.textContent=d.data().name;
    elList.appendChild(li);
  });
  btnStart.disabled = snap.size===0;
});

// é–‹å§‹éŠæˆ²
btnStart.onclick = async ()=>{
  await updateDoc(roomRef,{ status:"playing" });
  location.href = `game.html?pin=${pin}&host=1`;
};

</script>
</body>
</html>
